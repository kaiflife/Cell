<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
    >
    <meta
    name="description"
    content=""
    >
    <title>constructor</title>
</head>
<style>
    body {
        margin: 0;
        padding: 0;
    }
    header {
        height: 32px;
    }
    footer{
        display: none;
    }
    main {
        height: calc(100vh - 32px);
        display: grid;
    }
    .cell {
        flex: 1;
        border: 1px solid black;

        &.selected {
        border-color: red;
    }
}
.level {
    width: 32px;
}
</style>

<body>
<header>
  <input onchange="changeMenu(this)" list="menuList" name="menuInput" id="menuInput">
  <datalist id="menuList">
    <option value="verticalSlice">
    <option value="horizontalSlice">
    <option value="undo">
    <option value="redo">
  </datalist>
<input class="level" type="number" name="level" id="level" value="1" />
</header>
<main id='main'>
<div style="grid-row: 1" onclick="selectCell(this)" class="cell"></div>
</main>
<footer>
    <span id="gridTemplateRowsEl">1</span>
    <span id="columnsLengthEl">1</span>
    <div onclick="selectCell(this)" class="cell"></div>
</footer>
</body>
<script>
globalColumnsLength = 1

function selectCell(cell) {
    cell.classList.toggle('selected')
}

function createCells({ ids }) {
    fragment = new DocumentFragment()
    
    ids.forEach(id => fragment.append(
        createEl({
            className: 'cell',
            style: { 
                ['grid-row']: id,
            }
        })
    ))
    
    main.append(fragment)
}

function changeMainStyle(){
    rows = getRows()
    rowItemsCount = rows.length / globalColumnsLength
    main.style.gridTemplateArea = rangeArray(1, globalColumnsLength).reduce((prev, item, index) => {
        if (item != 1) {
            prev += "\n"
        }
        start = index * rowItemsCount
        end = rowItemsCount * item
        prev += rows.slice()
    })
}

function getRows(props) {
    const { isNumberArray } = {isNumberArray: false, ...props}
    rows = gridTemplateRowsEl.innerText
    
    return isNumberArray ? rows.split(' ').map(a => +a) : rows
}

function getColumnsLength() {
    return +columnsLength.innerText
}

function formatNewItems(items) {
    newMax = Math.max(...items)+1
    sliceCount = +level.value -1
    newNumbers = rangeArray(newMax, newMax + sliceCount)
    createCells({ ids: newNumbers })
    
    return [...items, ...newNumbers]
}

function changeMenu({ value }) {
    if(value === 'verticalSlice') {
        getAllCells().forEach(selected => {
            rows = getRows({ isNumberArray: true })
            gridTemplateRowsEl.innerHTML = formatNewItems(rows).join(' ')
        })
    }
}

function getAllCells(){
    const selects = document.querySelectorAll('.selected');
    return Array.from(selects)
}

function log(text, subtext = '') {
    console.log(text + subtext);
}

function createEl( {
elName = 'div',
className = '',
value = null,
type = '',
innerHTML = '',
appendTo = '',
onclick = null,
onchange = null,
style = {},
datasets = [],
appendInnerHTML = '',
}) {
const el = document.createElement(elName)

if (className) el.className = className
if (type) el.type = type
if (value) el.value = value
if (style) {
Object.keys(style).forEach(field => {
el.style[field] = style[field]
})
}
if (innerHTML) el.innerHTML = innerHTML
if (onclick) el.onclick = onclick
if (onchange) el.onchange = onchange
if (appendInnerHTML) el.append(appendInnerHTML)
if (datasets.length) {
datasets.forEach(dataset => {
el.dataset[dataset.name] = dataset.value
})
}

if (appendTo) {
if (appendTo === 'body') {
document.body.append(el)
} else {
document.querySelector(appendTo).append(el)
}
}
return el
}

function rangeArray(from = 0, to = 0) {
  if (from !== 0 && to !== 0) {
    const newArray = []
    for (let i = from; i <= to; i++) {
      newArray.push(i)
    }

    return newArray
  }

  return [...new Array(from || to).keys()]
}

</script>

</html>
