<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  >
  <meta
    name="description"
    content=""
  >
  <title>Constructor</title>
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    header {
      height: 32px;
    }

    footer {
      display: none;
    }

    main {
      height: calc(100vh - 32px);
      width: 100vw;
      display: flex;
    }

    .cell {
      flex: 1;
      border: 1px solid black;

      &.selected {
        border-color: red;
      }
    }

    .level {
      width: 32px;
    }
  </style>
</head>

<body>
  <header>
    <input
      onchange="changeMenu(this)"
      list="menuList"
      id="menuInput"
    >
    <datalist id="menuList">
      <option value="verticalSlice">
      <option value="horizontalSlice">
      <option value="undo">
      <option value="redo">
      <option value="unselectAll">
    </datalist>
    <input
      class="level"
      type="number"
      id="level"
      value="1"
    />
  </header>
  <main id="main">
    <div
      data-id='1'
      data-width="1"
      data-height="1"
      class="cell"
    ></div>
  </main>

  <script>
    const main = document.getElementById('main');
    const level = document.getElementById('level');
    maxId = 1

    function toggleMainClick(enable) {
      const action = enable ? 'addEventListener' : 'removeEventListener';
      main[action]('click', selectCell);
    }

    function getLevel() {
      return +level.value;
    }

    function getCellLength(element, isHeight = false) {
      return +element[`client${isHeight ? 'Height' : 'Width'}`]
    }

    function getRows() {
      return Array.from(main.children);
    }

    function getCells() {
      return main.querySelectorAll('.cell')
    }

    toggleMainClick(true);

    function selectCell(event) {
      const el = event.target;

      if (el.classList.contains('cell')) {
        el.classList.toggle('selected');
      }
    }

    function splitCell({ direction, selectedCell, place = 'after', selectedCells }) {
      const isHorizontal = direction === 'horizontalSlice';
      const isVertical = direction === 'verticalSlice'
      const mainRows = getRows();

      const fragment = document.createDocumentFragment();
      const newIds = getNewIds();

      if (isVertical) {
        width = Math.round(getCellLength(selectedCell) / (newIds.length + 1))

        newIds.forEach(id => {
          fragment.append(createEl({
            className: 'cell',
            datasets: [{ value: id, name: 'id' }],
            style: { width }
          }));
        });

        selectedCell.style.width = width

        selectedCell[place](fragment);
      }
    }

    function getCellId(cellEl) {
      const idString = +cellEl.dataset.id;
    }

    function getNewIds() {
      const from = maxId + 1;
      const sliceCount = getLevel() - 1;
      newMax = from + sliceCount
      maxId = newMax
      return rangeArray({ from, to: newMax });
    }

    function changeMenu(menuEl) {
      const { value } = menuEl;
      const selectedCells = getSelectedCells();

      if (value === 'verticalSlice' || value === 'horizontalSlice') {
        selectedCells.forEach((selectedCell) => splitCell({ direction: value, selectedCell, selectedCells }));
      } else if (value === 'unselectAll') {
        selectedCells.forEach(selectedCell => selectedCell.classList.toggle('selected'));
      }

      menuEl.value = '';
    }

    function getSelectedCells() {
      return Array.from(document.querySelectorAll('.selected'));
    }

    function createEl({ elName = 'div', className = '', type = '', datasets, innerHTML = '', style = {}, appendTo = '' }) {
      const el = document.createElement(elName);
      if (className) el.className = className;
      if (datasets) datasets.forEach(({ value, name }) => el.dataset[name] = value)
      if (type) el.type = type;
      if (style) Object.keys(style).forEach(styleKey => {
        el.style = style[styleKey]
      })
      if (innerHTML) el.innerHTML = innerHTML;
      if (appendTo) document.querySelector(appendTo).append(el);
      return el;
    }

    function rangeArray({ from = 0, to = 0, before = '', handler }) {
      const newArray = [];
      for (let index = from; index <= to; index++) {
        let value = `${before}${index}`;
        handler?.(value, index);
        newArray.push(value);
      }
      return newArray;
    }

    function compare(id1, id2) {
      return String(id1) === String(id2);
    }

    function log() {
      for (var i = 0; i < arguments.length; i++) {
        console.log(arguments[i])
      }
    }
  </script>
</body>

</html>